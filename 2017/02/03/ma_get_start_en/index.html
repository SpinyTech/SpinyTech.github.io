<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>The guide of the ModularizationArchitecture | Spiny</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">The guide of the ModularizationArchitecture</h1><a id="logo" href="/.">Spiny</a><p class="description">Stay Hungry, Stay Foolish, Stay Uncomfortable.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">The guide of the ModularizationArchitecture</h1><div class="post-meta">Feb 3, 2017<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/02/03/ma_get_start_en/" href="/2017/02/03/ma_get_start_en/#comments" class="ds-thread-count"></a><div class="post-content"><p><font color="red" size="4">Githup Repository：<a href="https://github.com/SpinyTech/ModularizationArchitecture" target="_blank" rel="external">ModularizationArchitecture</a><br>My Homepage：<a href="https://github.com/SpinyTech" target="_blank" rel="external">SpinyTech</a><br>Welcome to add star and follow.</font><br><br><br>ModularizationArchitecture is a routing-based multi-process, component-based architecture on the Android platform: it communicates with different modules and processes by sharing routes without referring to other modules. It is suitable for medium-sized App architecture team collaboration, parallel development, business line decoupling, white-box testing and other scenes.</p>
<h2 id="1-Definition-of-terms"><a href="#1-Definition-of-terms" class="headerlink" title="1. Definition of terms"></a>1. Definition of terms</h2><ul>
<li><code>Main App Module</code>：The main module of the project, which can be run on the mobile.</li>
<li><code>Library Moudule</code>：The library of the project. It is a business module or a functional component of the project.</li>
<li><code>Test App Module</code>：The main module of the project, which can be run on the mobile. It used to test a library module.</li>
<li><code>Action</code>：The specific implementation of Cross-module calls.</li>
<li><code>ActionResult</code>：The result returned by the Action invoke.</li>
<li><code>Provider</code>：Provider is a actions cluster, It make register actions easier.</li>
<li><code>RouterRequest</code>：The request when invoke an action.</li>
<li><code>RouterResponse</code>：The response when an action invoked completed.</li>
<li><code>LocalRouter</code>：The local router.</li>
<li><code>WideRouter</code>：The multiple process wide router.</li>
<li><code>LocalRouterConnectService</code>：The guard service of local router, used to connect with the wide router, perform AIDL cross-process communication.  </li>
</ul>
<h2 id="2-Getting-start"><a href="#2-Getting-start" class="headerlink" title="2. Getting start"></a>2. Getting start</h2><h3 id="2-1-Integration-in-the-project"><a href="#2-1-Integration-in-the-project" class="headerlink" title="2.1 Integration in the project"></a>2.1 Integration in the project</h3><p>First of all, we need to add the following code into the <code>build.gradle</code> of the <strong>Main App Module</strong> and <strong>all Library Moudule</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.spinytech.ma:macore:0.2.0&apos;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-Create-a-custom-Application"><a href="#2-2-Create-a-custom-Application" class="headerlink" title="2.2 Create a custom Application"></a>2.2 Create a custom Application</h3><p>Create a custom Application that inherits from the <code>MaApplication</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class CustomApplication extends MaApplication &#123;</span><br><span class="line"></span><br><span class="line">    // Register the local router for multiple processes</span><br><span class="line">, It is described in detail in chapter 2.7.1</span><br><span class="line">    @Override</span><br><span class="line">    public void initializeAllProcessRouter() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Register the logic of application, It is described in detail in chapter 2.3</span><br><span class="line">    @Override</span><br><span class="line">    protected void initializeLogic() &#123;</span><br><span class="line">        //The first argument represents the process name, the second indicates the initialization priority, and the third is the Application logic class, which is instantiated by reflection when needed.</span><br><span class="line">        registerApplicationLogic(&quot;com.spinytech.maindemo&quot;,999, MainApplicationLogic.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // The value of this methed returned means whether the app is multi-process, if it is a multi-process returns true, otherwise returns false.</span><br><span class="line">    @Override</span><br><span class="line">    public boolean needMultipleProcess() &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Please note:<br>The package name in <code>registerApplicationLogic(&quot;com.spinytech.maindemo&quot;, 999, MainApplicationLogic.class)</code> must be passed in constant. Please do not use the <code>context.getPackageName ()</code> method instead, otherwise the multiprocessing can not register the application logic correctly.</strong></p>
<p>Then add the following code to your <code>AndroidManifest.xml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;application</span><br><span class="line">      ...</span><br><span class="line">      android:name=&quot;xxx.xxx.CustomApplication&quot;</span><br><span class="line">      ...</span><br><span class="line">      &gt;</span><br><span class="line">      ...</span><br><span class="line">&lt;/application&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-Create-a-custom-ApplicationLogic"><a href="#2-3-Create-a-custom-ApplicationLogic" class="headerlink" title="2.3 Create a custom ApplicationLogic"></a>2.3 Create a custom ApplicationLogic</h3><p>In the <code>initializeLogic</code> method, you need to separate the application logic from the Application.The reason for the separation, because if the introduction of multi-process, Application will be initialized many times. If the application logic has separated, each Application initialization, for different processes, initialization of different logic.  </p>
<p>The lifecycle of <code>ApplicationLogic</code> and <code>Application</code> are the same, they all have <code>onCreate</code>, <code>onTerminate</code>, <code>onLowMemory</code> method and so on.</p>
<p>Create a custom <code>ApplicationLogic</code> that inherits from the <code>BaseApplicationLogic</code>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class CustomApplicationLogic extends BaseApplicationLogic &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        // Register providers. It is described in detail in chapter 2.4</span><br><span class="line">        LocalRouter.getInstance(mApplication).registerProvider(&quot;util&quot;,new UtilProvider());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void onTerminate()&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void onLowMemory()&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void onTrimMemory(int level)&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void onConfigurationChanged(Configuration newConfig) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-Create-a-custom-provider"><a href="#2-4-Create-a-custom-provider" class="headerlink" title="2.4 Create a custom provider"></a>2.4 Create a custom provider</h3><p><code>Provider</code> data structure is actually a HashMap, its function is to tie multiple Actions together, to facilitate the local router to register.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class UtilProvider extends MaProvider &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void registerActions() &#123;</span><br><span class="line">        registerAction(&quot;md5&quot;,new MD5EncryptAction());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>When the <code>Provider</code> is created, then register it to local router. It is usually registered in <code>onCreate</code> in <code>ApplicationLogic</code> (see 2.3). </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LocalRouter.getInstance(mApplication).registerProvider(&quot;util&quot;,new CustomProvider());</span><br></pre></td></tr></table></figure>
<p>The first parameter “util” is the provider key, it can be customized, It will be used later when we invoke the action.</p>
<h3 id="2-5-Create-a-custom-Action"><a href="#2-5-Create-a-custom-Action" class="headerlink" title="2.5 Create a custom Action"></a>2.5 Create a custom Action</h3><p>Each <code>Action</code> is a concrete implementation that provides to the invoke. We need to inherit and overwirte it.</p>
<p>There are two methods need to be overwriten, one is <code>isAsync()</code>, the other is <code>invoke()</code>.  </p>
<p><code>isAsync()</code> need to tell the caller whether the action is asynchronous. If it is asynchronous(such as network, IO and so on.), then return true, if it is synchronous return false. The reason for adding this judgment is that some action may be called in the main thread, we need to determine whether the action is time-consuming, and thus decide whether to start a new thread to invoke the action.   </p>
<p><code>Invoke ()</code> method is the actual implementation of the call. The method has a context <code>Context</code> and a set of request data<code>HashMap &lt;String, String&gt;</code>, which returns<code>AcationResult</code> as a result back to the caller.  </p>
<p>The data structure of <code>AcationResult</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    code:xxx,</span><br><span class="line">    msg:xxx,</span><br><span class="line">    data:xxx</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The implementation of the method is similar to that of a Web application, where a parameter is a set of key-value pairs, and the result is processed after a series of processing.  </p>
<p>Here we give a simple MD5 encryption example, create a custom <code>MD5EncryptAction</code> inherited from<code>MaAction</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class MD5EncryptAction extends MaAction &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isAsync(Context context, HashMap&lt;String, String&gt; requestData) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public MaActionResult invoke(Context context, HashMap&lt;String, String&gt; requestData) &#123;</span><br><span class="line">        String result = &quot;&quot;;</span><br><span class="line">        if(!TextUtils.isEmpty(requestData.get(&quot;params_1&quot;)))&#123;</span><br><span class="line">            result +=requestData.get(&quot;params_1&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if(!TextUtils.isEmpty(requestData.get(&quot;params_2&quot;)))&#123;</span><br><span class="line">            result +=requestData.get(&quot;params_2&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        // The MD5Util is a dummy util, here we do not implement it.</span><br><span class="line">        result = MD5Util.md5(temp);</span><br><span class="line">        </span><br><span class="line">        MaActionResult result = new MaActionResult.Builder()</span><br><span class="line">                .code(MaActionResult.CODE_SUCCESS)</span><br><span class="line">                .msg(&quot;success&quot;)</span><br><span class="line">                .data(result)</span><br><span class="line">                .object(null)</span><br><span class="line">                .build();</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>When the <code>Action</code> is created, then register it to <code>Provider</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registerAction(&quot;md5&quot;,new MD5EncryptAction());</span><br></pre></td></tr></table></figure>
<p>The first parameter “md5” is the action key, it can be customized, It will be used later when we invoke the action.  </p>
<h3 id="2-6-Invoke"><a href="#2-6-Invoke" class="headerlink" title="2.6 Invoke"></a>2.6 Invoke</h3><p>In previous chapters, we have defined everything, and we’ll invoke this chapter.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RouterResponse response = LocalRouter.getInstance(MaApplication.getMaApplication())</span><br><span class="line">                            .route(context, RouterRequest.obtain(context)</span><br><span class="line">                            .provider(&quot;util&quot;)</span><br><span class="line">                            .action(&quot;md5&quot;)</span><br><span class="line">                            .data(&quot;params_1&quot;, &quot;Hello&quot;)</span><br><span class="line">                            .data(&quot;params_2&quot;, &quot;World&quot;));</span><br></pre></td></tr></table></figure>
<p>First we get the instance of <code>LocalRouter</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LocalRouter.getInstance(MaApplication.getMaApplication())</span><br></pre></td></tr></table></figure>
<p>Then use <code>route</code> to invoke.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route(Context context,RouterRequest request)</span><br></pre></td></tr></table></figure>
<h3 id="2-6-1-Create-the-RouterRequest"><a href="#2-6-1-Create-the-RouterRequest" class="headerlink" title="2.6.1 Create the RouterRequest"></a>2.6.1 Create the RouterRequest</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RouterRequest.obtain(context)</span><br><span class="line">                            .provider(&quot;util&quot;)</span><br><span class="line">                            .action(&quot;md5&quot;)</span><br><span class="line">                            .data(&quot;params_1&quot;, &quot;Hello&quot;)</span><br><span class="line">                            .data(&quot;params_2&quot;, &quot;World&quot;);</span><br></pre></td></tr></table></figure>
<p>This code means that find the registration of the name “util” of the provider, and then find its registered name “md5” action. The two parameters is “params_1”, “params_2”.  </p>
<p>Send the router request to the local router to finish the invoke.</p>
<p><strong>Note: RouterRequest uses the object memory pool technology, will be recycled after use, so do not hold a reference to RouterRequest, in order to avoid unnecessary errors.</strong></p>
<h3 id="2-6-2-Deal-with-RouterResponse"><a href="#2-6-2-Deal-with-RouterResponse" class="headerlink" title="2.6.2 Deal with RouterResponse"></a>2.6.2 Deal with RouterResponse</h3><p>The <code>route()</code> method will return the instance of <code>RouterRequest</code>. This method is nonblocking and returns <code>RouterResponse</code> immediately after invoke. The <code>isAsync()</code> method of <code>RouterResponse</code> tells you whether the call is asynchronous or not. The<code>get()</code>method of<code>RouterResponse</code> returns the result of that call. <strong>Please note that the <code>get()</code> method may cause blocking, depending on <code>isAsync()</code>, so please be careful when you use the <code>get()</code> method in main thread.</strong></p>
<h3 id="2-7-Multiple-process"><a href="#2-7-Multiple-process" class="headerlink" title="2.7 Multiple process"></a>2.7 Multiple process</h3><p>In chapter 2.2, overwirte the <code>needMultipleProcess()</code> method and set the return true.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean needMultipleProcess() &#123;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-7-1-Create-connect-service-register-local-router"><a href="#2-7-1-Create-connect-service-register-local-router" class="headerlink" title="2.7.1 Create connect service, register local router"></a>2.7.1 Create connect service, register local router</h3><p>Because it involves multiple processes, so we need to use AIDL for inter-process communication. Therefore, each process within the app, you need to create a connection Service, used to communicate with the wide router.</p>
<p>Create a custom Service inherited from <code>LocalRouterConnectService</code>, we do not need to write any code.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class MainRouterConnectService extends LocalRouterConnectService &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>Register the connect service in <code>Androidmanifest.xml</code>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;service android:name=&quot;xxx.xxx.MainRouterConnectService&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>Then register the connect service in <code>initializeAllProcessRouter()</code> method.<br>The first parameter of <code>WideRouter.registerLocalRouter</code> method is the process name, the second is the class of the connect service. See the following code.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void initializeAllProcessRouter() &#123;</span><br><span class="line">    WideRouter.registerLocalRouter(&quot;com.spinytech.maindemo&quot;,MainRouterConnectService.class);</span><br><span class="line">    WideRouter.registerLocalRouter(&quot;com.spinytech.maindemo:music&quot;,MusicRouterConnectService.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-7-2-Cross-process-invoke"><a href="#2-7-2-Cross-process-invoke" class="headerlink" title="2.7.2 Cross-process invoke"></a>2.7.2 Cross-process invoke</h3><p>Cross-process invoking is similar to the local invoking. But in generating <code>RouterRequest</code> time, we need to add a <code>Domain</code>, <code>Domain</code> is the process name. (When you obtain the <code>RouterRequest</code>, if not add domain, the default domain is the current process name)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RouterRequest</span><br><span class="line">    .obtain(context)</span><br><span class="line">    .domain(&quot;com.spinytech.maindemo:music&quot;)</span><br><span class="line">    .provider(&quot;music&quot;)</span><br><span class="line">    .action(&quot;play&quot;);</span><br></pre></td></tr></table></figure>
<h3 id="2-8-RouterRequest-with-the-attachment-Object-and-RouterResponse-with-the-return-Object-Added-in-v0-2-0"><a href="#2-8-RouterRequest-with-the-attachment-Object-and-RouterResponse-with-the-return-Object-Added-in-v0-2-0" class="headerlink" title="2.8 RouterRequest with the attachment Object and RouterResponse with the return Object (Added in v0.2.0)"></a>2.8 RouterRequest with the attachment Object and RouterResponse with the return Object (Added in v0.2.0)</h3><p>In the v0.2.0 version, we added a function that we can add an attach object into the <code>RouterRequest</code>. (only in a single process).</p>
<p>In <code>RouterRequest</code>, the <code>object(Object attachment)</code> method is added to add the attachment object to the request.  </p>
<p>In the abstract class <code>MaAction</code>, we added two methods  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Public boolean isAsync (context context, HashMap &lt;String, String&gt; requestData, Object object)`  </span><br><span class="line">Public MaActionResult invoke (Context context, HashMap &lt;String, String&gt; requestData, Object object)</span><br></pre></td></tr></table></figure>
<p>By judging whether or not <code>RouterRequest</code> carries the attachment object,<code>LocalRouter</code> will call the different invoke methods.  </p>
<p>Related code:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RouterResponse.mIsAsync = attachment == null? TargetAction.isAsync (context, params): targetAction.isAsync (context, params, attachment);</span><br><span class="line">MaActionResult result = attachment == null? TargetAction.invoke (context, params): targetAction.invoke (context, params, attachment);</span><br></pre></td></tr></table></figure>
<p>When you return the result, you can use the <code>object(Object returnedObject)</code> method in <code>MaActionResult.Builder</code> to return an object instance to the caller, using the <code>getObject()</code> method of <code>RouterResponse</code> to get the returned Object.</p>
<p><strong> Please note: Because the inter-process memory is not shared, all attachments Object can only be passed in the process. The attachment object of the process will be ignored by default, please do not cross the process with the attachment Object call. </strong></p>
<p>For details, please refer to: [AttachObjectAction.java] (<a href="https://github.com/SpinyTech/ModularizationArchitecture/blob/master/maindemo/src/main/java/com/spinytech/maindemo/AttachObjectAction.java" target="_blank" rel="external">https://github.com/SpinyTech/ModularizationArchitecture/blob/master/maindemo/src/main/java/com/spinytech/maindemo/AttachObjectAction.java</a>)</p>
<h2 id="3-Principle"><a href="#3-Principle" class="headerlink" title="3. Principle"></a>3. Principle</h2><p>The principles of this architecture have not yet been translated into English. You can refer to the following article, and use google translate to read. If you have any questions, please email me. </p>
<p><a href="http://blog.spinytech.com/2016/12/28/android_modularization/">《Android架构思考》</a></p>
<h2 id="4-Defect"><a href="#4-Defect" class="headerlink" title="4. Defect"></a>4. Defect</h2><ul>
<li>Calls between two Apks of the same ShareUid are not supported at this time.</li>
<li>Need to inherit from <code>MaApplication</code>, the original <code>Application</code> code may be changed.</li>
</ul>
<h2 id="5-Future-plans"><a href="#5-Future-plans" class="headerlink" title="5. Future plans"></a>5. Future plans</h2><ul>
<li>Add the <code>Action</code> fail switch so that it can be dynamically controlled by the server.  </li>
<li>Add the <code>Action</code> hot fix feature.</li>
<li>Optimize the process of packaging and unpacking in the process of message passing.</li>
<li>Add <code>SocketAction</code> to make the <code>Action</code> can instant messaging.</li>
</ul>
<h2 id="6-Version"><a href="#6-Version" class="headerlink" title="6. Version"></a>6. Version</h2><h3 id="v0-2-0"><a href="#v0-2-0" class="headerlink" title="v0.2.0"></a>v0.2.0</h3><ul>
<li>Added a new method <code>object(Object attachment)</code> of <code>RouterRequest</code> that make <code>Action</code> can incomming a object parameter.  </li>
<li>The <code>Action</code> can return an attachment object by <code>MaActionResult</code>.  </li>
<li>Fixed some bugs.</li>
<li>New example is added to maindemo.</li>
</ul>
<hr>
<p>Original article, reproduced please contact the author: <a href="&#x6d;&#x61;&#105;&#x6c;&#116;&#111;&#58;&#115;&#112;&#x69;&#x6e;&#121;&#46;&#x74;&#x65;&#99;&#x68;&#x40;&#x67;&#109;&#97;&#105;&#x6c;&#x2e;&#x63;&#111;&#109;">&#115;&#112;&#x69;&#x6e;&#121;&#46;&#x74;&#x65;&#99;&#x68;&#x40;&#x67;&#109;&#97;&#105;&#x6c;&#x2e;&#x63;&#111;&#109;</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://blog.spinytech.com/2017/02/03/ma_get_start_en/" data-id="ciz7r0bnt001obdfyphu2rs8e" class="article-share-link">分享到</a><div class="tags"><a href="/tags/ModularizationArchitecture/">ModularizationArchitecture</a><a href="/tags/Architecture/">Architecture</a></div><div class="post-nav"><a href="/2017/02/01/ma_get_start_cn/" class="next">ModularizationArchitecture 使用教程</a></div><div data-thread-key="2017/02/03/ma_get_start_en/" data-title="The guide of the ModularizationArchitecture" data-url="http://blog.spinytech.com/2017/02/03/ma_get_start_en/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/02/03/ma_get_start_en/" data-title="The guide of the ModularizationArchitecture" data-url="http://blog.spinytech.com/2017/02/03/ma_get_start_en/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://blog.spinytech.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/翻译/">翻译</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/高并发/" style="font-size: 15px;">高并发</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/对象池/" style="font-size: 15px;">对象池</a> <a href="/tags/ModularizationArchitecture/" style="font-size: 15px;">ModularizationArchitecture</a> <a href="/tags/RxJava/" style="font-size: 15px;">RxJava</a> <a href="/tags/Dagger2/" style="font-size: 15px;">Dagger2</a> <a href="/tags/多进程/" style="font-size: 15px;">多进程</a> <a href="/tags/架构思考/" style="font-size: 15px;">架构思考</a> <a href="/tags/模块化/" style="font-size: 15px;">模块化</a> <a href="/tags/View绘制/" style="font-size: 15px;">View绘制</a> <a href="/tags/Android视图/" style="font-size: 15px;">Android视图</a> <a href="/tags/Architecture/" style="font-size: 15px;">Architecture</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/03/ma_get_start_en/">The guide of the ModularizationArchitecture</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/01/ma_get_start_cn/">ModularizationArchitecture 使用教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/10/concurrent_object_pool/">高并发对象池思考</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/28/android_modularization/">Android架构思考(模块化、多进程)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/19/android_view_on_draw/">View绘制分析笔记之onDraw</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/15/android_view_on_layout/">View绘制分析笔记之onLayout</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/12/android_view_on_measure/">View绘制分析笔记之onMeasure</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/02/android_view_draw_setcontentview/">Android 视图及View绘制分析笔记之setContentView</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/20/android_multiple_process_notice/">Android多进程注意事项</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/17/android_multiple_process_usage_scenario/">Android多进程使用场景</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Spiny.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'SpinyTech'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>